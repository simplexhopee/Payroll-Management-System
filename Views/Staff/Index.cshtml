@model IEnumerable<Checod_Africa.Models.staff>

@{
    ViewBag.Title = "Staff";
    Layout = "~/Views/Shared/_Layout.cshtml";

}

<h2>Staff List</h2>
<div style="text-align:right;">

    <!-- Button to open the create staff popup -->
    <button type="button" style="text-align:right;" class="main-button " onclick="newStaff()">NEW STAFF</button>

</div>
<div id="staff-container">

</div>

<!-- Add the staff details popup -->
<!-- Modal for displaying additional school details -->

<div id="myModal" class="modal fade">
    <div class="modal-dialog modal-confirm">
        <div class="modal-content">
            <div class="modal-header flex-column">
                <div class="icon-box">
                    <i class="material-icons">&#xE5CD;</i>
                </div>
                <h4 class="modal-title w-100">Are you sure?</h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this Staff? This process cannot be undone.</p>
            </div>
            <div class="modal-footer justify-content-center">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" onclick="deleteStaff()">Delete</button>
            </div>
        </div>
    </div>
</div>
<div id="detailsModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="detailsModalLabel" aria-hidden="true">
    <div class="create-modal modal-dialog">
        <div class="modal-content" style="height:100%; overflow-x:scroll;">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h3 class="modal-title" id="detailsModalLabel"></h3>
            </div>
            <div class="modal-body">
                <div id="schoolDetails"></div>
            </div>
        </div>
    </div>
</div>



<div id="successSaved" class="modal fade">
    <div class="modal-dialog modal-confirm">
        <div class="modal-content">
            <div class="modal-header flex-column">
                <div class="icon-box" style="border: 3px solid green;">
                    <i style="color:green;" class="material-icons">&#xE876;</i>
                </div>
                <h4 class="modal-title w-100">Success</h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            </div>
            <div class="modal-body">
                <p>Staff Saved Successfully</p>
            </div>
            <div class="modal-footer justify-content-center">

            </div>
        </div>
    </div>
</div>

<div id="successDelete" class="modal fade">
    <div class="modal-dialog modal-confirm">
        <div class="modal-content">
            <div class="modal-header flex-column">
                <div class="icon-box" style="border: 3px solid green;">
                    <i style="color:green;" class="material-icons">&#xE876;</i>
                </div>
                <h4 class="modal-title w-100">Success</h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            </div>
            <div class="modal-body">
                <p>Staff Deleted Successfully</p>
            </div>
            <div class="modal-footer justify-content-center">

            </div>
        </div>
    </div>
</div>




@section scripts {
    <!-- Add jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <script>
        $(document).ready(function () {
            // Check if a flag is set in sessionStorage indicating first-time load
           
                // Run your desired code here
            refresh();

                // Set the flag in sessionStorage to indicate that the function has run
              
        });
        function newStaff() {

            // Retrieve school details via AJAX request
            $.ajax({
                url: 'staff/CreatePopup',
                type: 'GET',
                data: {},
                success: function (result) {
                    $('#detailsModalLabel').html("New Staff");
                    $('#schoolDetails').html(result);
                    $('#detailsModal').modal('show');
                }
            });
        }

        var deleteid;


        function get_id(id) {
            deleteid = id;
        }

        function refresh() {
           
            $.ajax({
                url: 'staff/Refresh',
                type: 'GET',
                data: {},
                success: function (result) {
                   
                    $('#staff-container').html(result);

                }
            });
        }



        function showDetails(staff_id) {

            // Retrieve school details via AJAX request
            $.ajax({
                url: 'staff/DetailsPopup',
                type: 'GET',
                data: { id: staff_id },
                success: function (result) {
                    $('#detailsModalLabel').html("Staff Details");
                    $('#schoolDetails').html(result);
                    $('#detailsModal').modal('show');
                }
            });
        }

        function editStaff(staff_id) {
            // Retrieve the existing staff object via AJAX request
            $.ajax({
                url: 'staff/CreatePopup/' + staff_id,
                type: 'GET',
                success: function (data) {
                    // Parse the existing staff object into the _create partial view
                    $('#detailsModalLabel').html("Edit Staff");
                    $('#schoolDetails').html(data);
                    $('#detailsModal').modal('show');
                }
            });
        }

        function deleteStaff() {

            // Retrieve school details via AJAX request
            $.ajax({
                url: 'staff/DeleteStaff/' + deleteid,
                type: 'GET',
                success: function (result) {
                    // Close the popup
                    $('#detailsModal').modal('hide');
                    $('#myModal').modal('hide');


                    $('#successDelete').modal('show');
                    // Hide the successDelete modal after a few seconds
                    setTimeout(function () {
                        $('#successDelete').modal('hide');
                        refresh();
                    }, 1500); // Adjust the delay as needed


                    // Show a success message (optional)


                }
            });

        }
        function formatNumber(input) {
            // Remove any non-numeric characters except for a single '.'
            
            input.value = input.value.replace(/[^\d.]/g, '');
           
            // Split the value into integer and decimal parts
            const parts = input.value.split('.');
            const integerPart = parts[0] || '';
            const decimalPart = parts[1] || '';

            // Add commas to the integer part
            const formattedInteger = integerPart.replace(/\B(?=(\d{3})+(?!\d))/g, ',');

            // Combine the integer and decimal parts with a single dot '.'
            input.value = formattedInteger + (input.value.includes('.') ? '.' + decimalPart : '');

            // Update the validation message
            
        }
      

    </script>
}